// This is your Prisma schema for PostgreSQL (Neon)
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                      String             @id @default(uuid())
  discordId              String             @unique @map("discord_id")
  email                  String             @unique
  image                  String?
  role                   String             @default("USER")
  subscriptionStatus     String             @default("INACTIVE")
  subscriptionPlan       String?
  subscriptionExpiresAt  DateTime?          @map("subscription_expires_at")
  createdAt              DateTime           @default(now()) @map("created_at")
  updatedAt              DateTime           @updatedAt @map("updated_at")

  @@map("users")
}

model Username {
  id            String    @id @default(uuid())
  name          String
  platform      String
  category      String
  status        String    @default("AVAILABLE")
  availableDate DateTime? @map("available_date")
  foundAt       DateTime  @default(now()) @map("found_at")
  createdAt     DateTime  @default(now()) @map("created_at")

  @@unique([name, platform])
  @@map("usernames")
}

model SearchLog {
  id          String   @id @default(uuid())
  discordId   String   @map("discord_id")
  searchCount Int      @default(1) @map("search_count")
  lastSearched DateTime @default(now()) @map("last_searched")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@unique([discordId])
  @@map("search_logs")
}

model Webhook {
  id          String   @id @default(uuid())
  channelId   String   @unique @map("channel_id")
  platform    String   @default("discord")
  category    String   @default("RANDOM")
  webhookUrl  String?  @map("webhook_url")
  serverId    String?  @map("server_id")
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("webhooks")
}

model SupportTicket {
  id          String   @id @default(uuid())
  userId      String   @map("user_id")
  userName    String?  @map("user_name")
  userEmail   String?  @map("user_email")
  status      String   @default("OPEN") // OPEN, IN_PROGRESS, CLOSED
  assignedTo  String?  @map("assigned_to")
  assignedToName String? @map("assigned_to_name")
  userTyping  Boolean  @default(false) @map("user_typing")
  supportTyping Boolean @default(false) @map("support_typing")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("support_tickets")
}

model SupportMessage {
  id        String   @id @default(uuid())
  ticketId  String   @map("ticket_id")
  sender    String   // USER or SUPPORT
  senderName String  @map("sender_name")
  message   String
  createdAt DateTime @default(now()) @map("created_at")

  @@map("support_messages")
}

// External Discord sources for username scanning
model DiscordSource {
  id          String   @id @default(uuid())
  name        String
  serverId    String   @unique @map("server_id")
  channelId   String   @map("channel_id")
  threadId    String?  @map("thread_id")
  webhookUrl  String?  @map("webhook_url")
  isActive    Boolean  @default(true) @map("is_active")
  category    String   @default("DISCORD_FREE") // DISCORD_FREE, MINECRAFT, ROBLOX, etc
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("discord_sources")
}
